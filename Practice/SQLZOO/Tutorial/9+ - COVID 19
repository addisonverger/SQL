--All resources provided by SQLZOO: https://new.sqlzoo.net/wiki/Window_LAG

--1. Introducing the covid table

SELECT name, DAY(whn), confirmed, deaths, recovered
FROM covid
WHERE name = 'Spain'
AND MONTH(whn) = 3 
AND YEAR(whn) = 2020
ORDER BY whn

--2. Introducing the LAG function

SELECT name, DAY(whn), confirmed, LAG(confirmed, 1) OVER (PARTITION BY name ORDER BY whn)
FROM covid
WHERE name = 'Italy'
AND MONTH(whn) = 3 
AND YEAR(whn) = 2020
ORDER BY whn

--3. Number of new cases

SELECT name, DAY(whn), confirmed - LAG(confirmed, 1) OVER (PARTITION BY name ORDER BY whn)
FROM covid
WHERE name = 'Italy'
AND MONTH(whn) = 3 
AND YEAR(whn) = 2020
ORDER BY whn

--4. Weekly changes

SELECT name, DATE_FORMAT(whn,'%Y-%m-%d'), confirmed - LAG(confirmed, 1) OVER (PARTITION BY name ORDER BY whn) AS new_cases
FROM covid
WHERE name = 'Italy'
AND WEEKDAY(whn) = 0 
AND YEAR(whn) = 2020
ORDER BY whn
